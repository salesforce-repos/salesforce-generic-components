<template>
  <template if:true={errorMessage}>
    <div
      class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme--error"
      role="alert"
    >
      {errorMessage}
    </div>
  </template>

  <lightning-card
    title={label}
    if:false={errorMessage}
    class="slds-p-around--none"
  >
    <div
      class="slds-grid slds-gutters slds-p-left--large slds-p-bottom_medium slds-p-right--large"
    >
      <div
        class="slds-col slds-size--4-of-12 slds-border_top slds-var-m-right_x-small slds-border_right slds-border_bottom slds-border_left"
      >
        <lightning-combobox
          lwc:if={objectList.length}
          class="slds-p-left--none"
          name="objectType"
          label="Object Type"
          placeholder="Select Object Type"
          value={selectedObject}
          options={objectList}
          onchange={handleObjectChange}
          dropdown-alignment="auto"
          variant="label-stacked"
        ></lightning-combobox>

        <div class="exampleHolder">
          <lightning-spinner
            lwc:if={isLoading}
            alternative-text="Loading"
          ></lightning-spinner>
        </div>

        <div class="container" lwc:if={fieldDetails.length}>
          <!--<div class="header">
            <div class="header-content">
              <div class="buttons-container">
                <lightning-button
                  label="+ Add All"
                  onclick={addAllFields}
                  variant="base"
                  class="add-button slds-m-left_x-small"
                ></lightning-button>
                <lightning-button
                  label="- Remove All"
                  onclick={removeAllFields}
                  variant="base"
                  class="add-button slds-m-left_x-small"
                ></lightning-button>
              </div>
            </div>
          </div>-->

          <lightning-dual-listbox
            name="languages"
            label="Select Fields"
            source-label="Available"
            selected-label="Selected"
            field-level-help="Select Fields To Display"
            options={fieldDetails}
            onchange={handleFieldChange}
            value={selectedFields}
          ></lightning-dual-listbox>
          <!--value={selectedFields}-->

          <!--<div class="list-container">
            <template for:each={fieldDetails} for:item="item" for:index="index">
              <div key={item.value} class="item">
                <lightning-input
                  type="checkbox"
                  label={item.label}
                  checked={item.selected}
                  onchange={handleFieldChange}
                  data-index={index}
                ></lightning-input>
              </div>
            </template>
          </div>-->
        </div>
      </div>

      <div
        class={selectedObjectClass}
        style="position: relative; padding-left: 50px"
      >
        <div style={conditionBuilderStyle}>
          <span class="slds-p-left--xx-small generated-class">
            {labels.generatedQuery}
          </span>
          <div>
            <c-dynamic-filter
              object-api-name={selectedObject}
              field-options={fieldOptions}
              field-details={fieldDetails}
              selected-fields={selectedFields}
              filters={filters}
              onfetchresults={fetchResults}
            ></c-dynamic-filter>
          </div>

          <div class="slds-grid slds-wrap slds-p-left--xx-small">
            <div class="slds-col slds-size--4-of-12 slds-p-around_none">
              <lightning-input
                name="limit"
                type="Number"
                label="Limit"
                value={limit}
                max="50000"
                disabled={isRHSDisabled}
                onchange={handleLimitChanged}
              >
              </lightning-input>
            </div>
            <div class="slds-col slds-size--5-of-12 slds-p-around_none">
              <lightning-combobox
                name="orderByField"
                label="Order By"
                placeholder=""
                variant="label-stacked"
                value={orderByField}
                disabled={isRHSDisabled}
                options={fieldOptionsWithNone}
                onchange={handleOrderByChanged}
              ></lightning-combobox>
            </div>
            <div class="slds-col slds-size--3-of-12 slds-p-around_none">
              <lightning-combobox
                name="orderByDirection"
                label="Direction"
                placeholder=""
                variant="label-stacked"
                value={orderByDirection}
                options={orderByDirections}
                disabled={isRHSDisabled}
                onchange={handleDirectionChanged}
              ></lightning-combobox>
            </div>
          </div>
        </div>

        <div class="btn-fetch" style={conditionBuilderStyle}>
          <lightning-button
            label="Fetch Data"
            title="Fetch Data"
            variant="brand"
            onclick={handleFetchResults}
          ></lightning-button>
        </div>

        <div
          class="slds-grid slds-wrap slds-p-top_medium slds-p-bottom_medium slds-p-left--xx-small"
        >
          <!--<div
            class="slds-col slds-size_1-of-1 slds-border_top slds-border_right slds-border_bottom slds-border_left"
            lwc:if={showDatatable}
          >
            <c-lwc-datatable-utility
              records={queryData}
              total-records={queryData.length}
              columns={selectedColumnsMap}
              key-field="Id"
              editable="true"
              can-delete="true"
              show-search-box="true"
              max-row-selection={queryData.length}
              onpaginatorchange={handlePaginatorChange}
              onsetselectedrecords={handleAllSelectedRows}
              object-name={selectedObject}
              table-height="200"
            >
            </c-lwc-datatable-utility>-->

          <!--<c-common-datatable
              columns={selectedColumnsMap}
              records={queryData}
              editable="true"
              can-delete="true"
              show-pagination="true"
              pagination-size="5"
              object-name={selectedObject}
              enable-field-search="true"
              search-fields={columnsToSearch}
            ></c-common-datatable>-->

          <!--<c-dynamic-table
              object-data={queryData}
              selected-columns={selectedColumnsMap}
            >
            </c-dynamic-table>
          </div>-->
        </div>
      </div>
    </div>

    <div
      class="slds-grid slds-gutters slds-p-left--large slds-p-right--medium"
      lwc:if={showDatatable}
    >
      <div
        class="slds-col slds-size--1-of-1 slds-border_top slds-border_right slds-border_bottom slds-border_left"
      >
        <c-lwc-datatable-utility
          records={queryData}
          total-records={queryData.length}
          columns={selectedColumnsMap}
          key-field="Id"
          editable="true"
          can-delete="true"
          show-search-box="true"
          max-row-selection={queryData.length}
          onpaginatorchange={handlePaginatorChange}
          onsetselectedrecords={handleAllSelectedRows}
          object-name={selectedObject}
          table-height="200"
        >
        </c-lwc-datatable-utility>
      </div>
    </div>
  </lightning-card>
</template>